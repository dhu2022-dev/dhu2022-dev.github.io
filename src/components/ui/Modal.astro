---
const { id = "movieModal", title = "Movie" } = Astro.props;
---

<div id={id} class="modalOverlay" style="display:none;">
  <div class="modalContent">
    <button type="button" class="modalClose" data-close>âœ•</button>
    <h2 class="modalTitle">{title}</h2>
    <div class="modalBody" data-body></div>
  </div>
</div>

<style>
  .modalOverlay {
    position: fixed;
    inset: 0;
    background: rgba(0,0,0,.55);
    padding: 24px;
    z-index: 9999;
  }
  .modalContent {
    max-width: 780px;
    margin: 0 auto;
    background: #fff;
    color: #111;
    border-radius: 16px;
    padding: 16px;
    position: relative;
  }
  .modalClose {
    position: absolute;
    top: 10px;
    right: 10px;
    background: transparent;
    border: none;
    font-size: 24px;
    cursor: pointer;
    color: #111;
    padding: 4px 8px;
    line-height: 1;
  }
  .modalTitle {
    margin: 0 0 10px;
    color: #111;
  }
  .modalBody {
    color: #111;
  }
  .modalBody a {
    color: #0066cc;
  }
  .modalBody a:hover {
    text-decoration: underline;
  }
  @media (prefers-color-scheme: dark) {
    .modalContent {
      background: #1a1a1a;
      color: #fff;
    }
    .modalClose {
      color: #fff;
    }
    .modalClose:hover {
      opacity: 0.7;
    }
    .modalTitle {
      color: #fff;
    }
    .modalBody {
      color: #fff;
    }
    .modalBody a {
      color: #66b3ff;
    }
    /* Fix tag borders in dark mode */
    .modalBody span[style*="border:1px solid #ddd"] {
      border-color: #444 !important;
    }
    /* Fix placeholder backgrounds in dark mode */
    .modalBody div[style*="background:#eee"] {
      background: #333 !important;
    }
  }
</style>

  <script is:inline define:vars={{ modalId: id }}>
    (function () {
      var root = document.getElementById(modalId);
      if (!root) {
        console.warn("[Modal] root not found:", modalId);
        return;
      }

      function close() {
        root.style.display = "none";
        document.body.style.overflow = "";
      }

      function openWithHtml(html) {
        var body = root.querySelector("[data-body]");
        if (body) body.innerHTML = html || "<p>No details yet.</p>";
        root.style.display = "block";
        document.body.style.overflow = "hidden";
      }

      var closeBtn = root.querySelector("[data-close]");
      if (closeBtn) closeBtn.addEventListener("click", close);

      root.addEventListener("click", function (e) {
        if (e.target === root) close();
      });

      window.addEventListener("keydown", function (e) {
        if (e.key === "Escape") close();
      });

      window.__openModal = openWithHtml;
      window.__closeModal = close;
    })();
  </script>
</div>
